name: Action Usage

on:
  push:

jobs:
  get_branch:
    runs-on: ubuntu-latest
    outputs:
      branch: ${{ steps.extract_branch.outputs.branch }}
    steps:
    - name: Get Branch Name
      id: extract_branch
      run: echo "branch=$(echo ${GITHUB_REF#refs/heads/} | sed -nE 's#.*?([a-zA-Z]{3}-[0-9]{0,5})$#\1#p')" >> $GITHUB_OUTPUT
    
  action_usage:
    runs-on: ubuntu-latest
    needs: get_branch
    steps:
    - name: Check out repository code
      uses: actions/checkout@v3
    - name: list
      run: |
        echo ${{ needs.get_branch.outputs.branch }}
        ls -la ${PWD}
    - name: Set Branch as Environment Variable
      run: echo "BRANCH=${{ needs.get_branch.outputs.branch }}" >> $GITHUB_ENV
    - id: action_step
      name: Action Step
      uses: ./actions/action@$BRANCH
