name: Add Branch Name as First Commit Message

on:
  push:

jobs:
  husky:
    runs-on: ubuntu-latest
    steps:
    - name: Install husky
      run: |
        npm install husky --save-dev >> $GITHUB_STEP_SUMMARY
    - name: Install hooks
      run: |
        npx husky install >> $GITHUB_STEP_SUMMARY
    - name: Add hooks
      run: |
        echo "PWD: $PWD"
        echo "ll pwd: $(ls -la $PWD)"
        cd ..
        echo "PWD: $PWD"
        echo "ll pwd: $(ls -la $PWD)"
        npx husky add ../../.husky/pre-commit "echo 'pre commit'"
        npx husky add ../../.husky/commit-msg "echo 'commit message'"
      
  add-commit-message:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Get branch name
        id: get-branch-name
        #run: echo "::set-output name=branch-name::$(echo ${GITHUB_REF#refs/heads/} | sed -E 's/[^a-zA-Z0-9]+/-/g')"
        run: |
          echo "branch-name=$(echo ${GITHUB_REF#refs/heads/} | sed -nE 's#.*?([a-zA-Z]{3}-[0-9]{0,5})$#\1#p')" >> $GITHUB_OUTPUT
          echo "branch-name=$(echo ${GITHUB_REF#refs/heads/} | sed -nE 's#.*?([a-zA-Z]{3}-[0-9]{0,5})$#\1#p')" >> $GITHUB_STEP_SUMMARY
          echo "${GITHUB_REF#refs/heads/}" >> $GITHUB_STEP_SUMMARY
